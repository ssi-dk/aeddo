<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="aeddo">
<title>Automated and Early Detection of Disease Outbreaks • aeddo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Automated and Early Detection of Disease Outbreaks">
<meta property="og:description" content="aeddo">
<meta property="og:image" content="https://ssi-dk.github.io/aeddo/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aeddo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/aeddo.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ssi-dk/aeddo/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Automated and Early Detection of Disease Outbreaks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ssi-dk/aeddo/blob/HEAD/vignettes/aeddo.Rmd" class="external-link"><code>vignettes/aeddo.Rmd</code></a></small>
      <div class="d-none name"><code>aeddo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The novel algorithm utilizes a hierarchical generalized linear model
as a modeling framework to model the count observations <span class="math inline">\(y\)</span> and assess the unobserved random
effects <span class="math inline">\(u\)</span>. These random effects are
used directly in the detection algorithm to characterize an
outbreak.</p>
<div class="section level3">
<h3 id="applying-the-algorithm">Applying the algorithm<a class="anchor" aria-label="anchor" href="#applying-the-algorithm"></a>
</h3>
<p>To install ‘aeddo’, you can use the following command to obtain the
development version from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ssi-dk/aeddo"</span><span class="op">)</span></span></code></pre></div>
<p>or from CRAN:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"aeddo"</span><span class="op">)</span></span></code></pre></div>
<p>Now, the library is loaded, to expose the functions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ssi-dk.github.io/aeddo/">aeddo</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ggplot2'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:aeddo':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     autoplot</span></span></code></pre></div>
<p>In this vignette, the ‘aeddo’ algorithm is applied to the <em>Monthly
Deaths from Lung Diseases in the UK</em> (source: P. J. Diggle (1990)
<em>Time Series: A Biostatistical Introduction</em>. Oxford, table A.3).
The data set is accessible trough the ‘MASS’ R package</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MASS/man/deaths.html" class="external-link">deaths</a></span></span></code></pre></div>
<p>To get an idea of how the monthly data looks like, it is visualized
in the following figure</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span></span></code></pre></div>
<p><img src="aeddo_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Clearly, an annual seasonal component is seen in the data. Thus, a
fixed-effects model incorporating seasonality using Fourier terms is
hypothesized:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">m</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">m</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p>It is time to preprocess the data. First, the ‘ts’ object is broken
down into a time stamp and observations. This is achieved partly through
the ‘zoo’ R package:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract timestamp</span></span>
<span><span class="va">timestamp</span> <span class="op">&lt;-</span> <span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.yearmon</a></span><span class="op">(</span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ... and observations</span></span>
<span><span class="va">observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span></span></code></pre></div>
<p>Then, it is needed to compute the month within a year, <span class="math inline">\(m\)</span>, which is needed for the Fourier
terms:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">timestamp</span>, <span class="st">"%m"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, it is bundled together in a data.frame:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bundle up in data.frame</span></span>
<span><span class="va">processed_deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="va">timestamp</span>,</span>
<span>  y <span class="op">=</span> <span class="va">observations</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  m <span class="op">=</span> <span class="va">m</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As there are no information available on the population sizes at the
given time stamps, <span class="math inline">\(n\)</span> is fixed at 1.
For the purpose of this example, it is assumed that a rolling window of
size 24 months is appropriate for the parameter estimation. Moreover,
the disease threshold, <span class="math inline">\(U_{t_0}\)</span> is
based on the 90% quantile of the second-stage random effects
distribution:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span><span class="va">sig_level</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span></code></pre></div>
<p>The ‘aeddo’ algorithm is applied to the data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aeddo_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aeddo.html">aeddo</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">processed_deaths</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">formula</span>,</span>
<span>  k <span class="op">=</span> <span class="va">k</span>,</span>
<span>  sig_level <span class="op">=</span> <span class="va">sig_level</span>,</span>
<span>  exclude_past_outbreaks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  init_theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-6</span>, <span class="op">-</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">6</span>, <span class="fl">1e-6</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e2</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"L-BFGS-B"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-aeddo-package-implements-s3-methods">The aeddo package implements S3 methods<a class="anchor" aria-label="anchor" href="#the-aeddo-package-implements-s3-methods"></a>
</h3>
<p>Among other things, the ‘aeddo’ R package incorporates S3 methods,
that allow for easy visualization of the outcome of the algorithm. This
includes an <code><a href="../reference/autoplot.html">autoplot()</a></code> function, but also a wrapper for the
autoplot function, <code><a href="../reference/plot.html">plot()</a></code>. One can use either:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">aeddo_results</span><span class="op">)</span></span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">aeddo_results</span><span class="op">)</span></span></code></pre></div>
<p><img src="aeddo_files/figure-html/aeddo_viz-1.png" width="700"></p>
<p>To visualize the results. Here, the circles inside the grey area
represent the training observations, the dim circles after the training
period represents observations within the expected range, and the full
opacity circles after the training period represents outbreak-related
observations. Hence, there are found 6 outbreak-related observations in
the data set.</p>
</div>
<div class="section level3">
<h3 id="formulation-of-the-hiearchical-generalzied-linear-model">Formulation of the hiearchical generalzied linear model<a class="anchor" aria-label="anchor" href="#formulation-of-the-hiearchical-generalzied-linear-model"></a>
</h3>
<p>The hierarchical generalized linear model used by the novel outbreak
detection algorithm is formulated as a hierarchical Poisson Gamma model.
This section present the derivation of the marginal distribution of
<span class="math inline">\(Y\)</span> along with the joint likelihood
function for the first and second stage models. For reference on
hierarchical models, see Henrik Madsen and Poul Thyregod (2011), ISBN:
9781420091557.</p>
<p>In the compound Poisson Gamma model the conditional distribution of
the count observations are assumed to be a Poisson distribution with
intensities <span class="math inline">\(\lambda\)</span></p>
<p><span class="math display">\[\begin{equation}
  f_{Y|u}(y;u,\beta)=\frac{(\lambda u)^{y}}{y!}\exp(-\lambda u)
\end{equation}\]</span></p>
<p>The probability density function for the random effects <span class="math inline">\(u\)</span> are assumed to follow a reparametrized
Gamma distribution with mean <span class="math inline">\(1\)</span>,
<span class="math inline">\(u \sim \mathrm{G}(1/\phi,\phi)\)</span> that
is</p>
<p><span class="math display">\[\begin{equation}
  f_{u}(u;\phi)=\frac{1}{\phi \Gamma(1/\phi)}
\bigg(\frac{u}{\phi}\bigg)^{1/\phi-1} \exp (-u/\phi)
\end{equation}\]</span></p>
<p>Subsequently, the model can be formulated as a two-level hierarchical
model</p>
<p></p>
<p>The probability function for the marginal distribution of <span class="math inline">\(Y\)</span> is determined from</p>
<p><span class="math display">\[\begin{equation}
  \begin{aligned}
    g_{Y}(y;\beta,\phi)&amp;=\int_{u=0}^\infty f_{Y|u}(y;u,\beta)
f_{u}(u;\phi) \,du \\
    &amp;=\int_{u=0}^\infty \frac{(\lambda u)^y}{y!} \exp (-\lambda u)
\frac{1}{\phi \Gamma(1/\phi)} \bigg(\frac{u}{\phi}\bigg)^{1/\phi-1} \exp
(-u /\phi) \,du\\
    &amp;=\frac{\lambda^{y}}{y!\Gamma(1/\phi)\phi^{1/\phi}}
\int_{u=0}^\infty u^{y+1/\phi-1} \exp \big(-u(\lambda \phi+1)/\phi\big)
\,du
  \end{aligned}
\end{equation}\]</span></p>
<p>It is noted that the integrand is the kernel in the probability
density function for a Gamma distribution, <span class="math inline">\(\mathrm{G}\big(y+1/\phi,\phi/(\lambda
\phi+1)\big)\)</span>. As the integral of the density shall equal one,
it is found by adjusting the norming constant that</p>
<p><span class="math display">\[\begin{equation}
  \int_{u=0}^\infty  u^{ y+ 1/\phi-1} \exp \Big(- u/\big(\phi/( \lambda
\phi+1)\big)\Big) \,du = \frac{\phi^{ y+ 1/\phi}\Gamma( y+ 1/\phi)}{(
\lambda \phi + 1)^{y+1/\phi}}
\end{equation}\]</span></p>
<p>Therefore, it is shown that the marginal distribution of <span class="math inline">\(Y\)</span> is a Negative Binomial distribution,
<span class="math inline">\(Y\sim\mathrm{NB}\big(1/\phi,1/(\lambda\phi+1)\big)\)</span>.
The probability function for <span class="math inline">\(Y\)</span>
is</p>
<p><span class="math display">\[\begin{equation}
  \begin{aligned}
    P[Y=y]&amp;=g_{Y}(y; \beta, \phi) \\
    &amp;=\frac{\lambda^{y}}{y!\Gamma(1/\phi)\phi^{1/\phi}}\frac{\phi^{y+1/\phi}\Gamma(y+1/\phi)}{(\lambda
\phi + 1)^{y+1/\phi}} \\
    &amp;=\frac{\Gamma(y+1/\phi)}{\Gamma(1/\phi)y!}\frac{1}{(\lambda\phi+1)^{1/\phi}}\bigg(\frac{\lambda\phi}{\lambda\phi+1}\bigg)^{y}
\\
    &amp;=\begin{pmatrix} y+1/\phi-1 \\ y \end{pmatrix}
\frac{1}{(\lambda\phi+1)^{1/\phi}}\bigg(\frac{\lambda\phi}{\lambda\phi+1}\bigg)^{y}
\ , \quad \mathrm{for} \ y = 0, 1, 2, \dots
  \end{aligned}
\end{equation}\]</span></p>
<p>where the following convention is used</p>
<p><span class="math display">\[\begin{equation}
  \begin{pmatrix} z\\y \end{pmatrix} =
\frac{\Gamma(z+1)}{\Gamma(z+1-y)y!}
\end{equation}\]</span></p>
<p>for <span class="math inline">\(z\)</span> real and <span class="math inline">\(y\)</span> integer values. Consequently, the mean
and variance of <span class="math inline">\(Y\)</span> are given by</p>
<p><span class="math display">\[\begin{equation}
  \mathrm{E}[Y] = \lambda \qquad \mathrm{V}[Y] = \lambda (\lambda \phi +
1)
\end{equation}\]</span></p>
<p>The joint likelihood function for estimating <span class="math inline">\((\beta,\phi)\)</span> is</p>
<p><span class="math display">\[\begin{equation}
  L( \beta, \phi; y_{it})=\prod_{t=1}^{T}\prod_{i=1}^{m} \begin{pmatrix}
y_{it}+1/\phi-1 \\ y_{it} \end{pmatrix}
\frac{1}{(\lambda_{it}\phi+1)^{1/\phi}}\bigg(\frac{\lambda_{it}\phi}{\lambda_{it}\phi+1}\bigg)^{y_{it}}
\end{equation}\]</span></p>
</div>
<div class="section level3">
<h3 id="inference-on-individual-groups">Inference on individual groups<a class="anchor" aria-label="anchor" href="#inference-on-individual-groups"></a>
</h3>
<p>Consider the compound Poisson Gamma model, and assume that a value
<span class="math inline">\(Y=y\)</span> has been observed.</p>
<p>The conditional distribution of <span class="math inline">\(u\)</span> for given <span class="math inline">\(Y=y\)</span> is found using Bayes Theorem. In
order to simplify the notation, the subscript indicating the group and
time are omitted. <span class="math display">\[\begin{equation}
  \begin{aligned}
    g_{u}(u|Y=y)&amp;=\frac{f_{y,u}(y,u)}{g_Y(y;\lambda, \phi)} \\
    &amp;=\frac{f_{y|u}(y;u)g_{u}(u)}{g_{Y}(y;\lambda,\phi)} \\
    &amp;=\frac{1}{g_{Y}(y;\lambda,\phi)}\Bigg(\frac{(\lambda u)^y}{y!}
\exp (-\lambda u) \frac{1}{\phi \Gamma(1/\phi)}
\bigg(\frac{u}{\phi}\bigg)^{1/\phi-1} \exp (-u/\phi)\Bigg) \\
    &amp;\propto u^{y+1/\phi-1} \exp \big(- u(\lambda\phi+1)/\phi\big)
  \end{aligned}
\end{equation}\]</span></p>
<p>Here, the of the probability density function is identified</p>
<p><span class="math display">\[\begin{equation}
  u^{y+1/\phi-1} \exp (- u(\lambda\phi+1)/\phi)
\end{equation}\]</span></p>
<p>as the kernel of a Gamma distribution, <span class="math inline">\(\mathrm{G}(y+1/\phi,\phi/(\lambda\phi+1))\)</span>,
i.e. the conditional distribution of <span class="math inline">\(u\)</span> for given <span class="math inline">\(Y=y\)</span> can be written as</p>
<p><span class="math display">\[\begin{equation}
  u| Y=y\sim \mathrm{G}\big(y+1/\phi,\phi/(\lambda \phi+1)\big)
\end{equation}\]</span></p>
<p>The mean of the conditional distribution is given by:</p>
<p><span class="math display">\[\begin{equation}
  \mathrm{E}[u|Y=y]=\frac{y\phi+1}{\lambda \phi+1}
\end{equation}\]</span></p>
<p>And the variance of the conditional distribution is:</p>
<p><span class="math display">\[\begin{equation}
  \mathrm{V}[u|Y=y]=\frac{( \phi^2+\phi)}{(\lambda \phi + 1)^2}
\end{equation}\]</span></p>
<p>These formulas provide the mean and variance of the conditional
distribution of <span class="math inline">\(u\)</span> given the
observed value <span class="math inline">\(Y=y\)</span>.</p>
</div>
<div class="section level3">
<h3 id="the-rationale-for-employing-the-gamma-distribution-as-a-second-stage-model">The rationale for employing the Gamma distribution as a second stage
model<a class="anchor" aria-label="anchor" href="#the-rationale-for-employing-the-gamma-distribution-as-a-second-stage-model"></a>
</h3>
<p>The choice of the Gamma distribution for modeling the random effects
has been motivated by several reasons. Firstly, the support of the Gamma
distribution, which ranges from 0 to infinity, aligns with the
mean-value space, denoted as <span class="math inline">\(\mathcal{M}\)</span>, for the Poisson
distribution. This ensures that the random effects are constrained
within a meaningful range for the underlying Poisson process.</p>
<p>Secondly, the two-parameter family of Gamma distributions offers
considerable flexibility, encompassing a wide range of shapes and
distributions that can span from exponential-like distributions to
fairly symmetrical distributions on the positive real line. This
flexibility allows the model to capture various patterns and
characteristics observed in the data.</p>
<p>Additionally, the choice of the Gamma distribution has benefits in
terms of the derivation of the marginal distribution of the response
variable <span class="math inline">\(Y\)</span>. The kernel <span class="math inline">\(u^{\alpha-1}\exp(-u/\beta)\)</span> of the Gamma
distribution used for modeling the random effects exhibits a similar
structure to the kernel <span class="math inline">\(u^y\exp(-u)\)</span>
of the likelihood function corresponding to the sampling distribution of
<span class="math inline">\(Y\)</span>. This similarity facilitates the
analytical computation of the integral involved in deriving the marginal
distribution, as it can be expressed in terms of known functions.</p>
<p>Overall, the Gamma distribution is selected due to its alignment with
the mean-value space of the Poisson distribution, its flexibility in
capturing diverse distributions, and its analytical convenience in
computing the marginal distribution of the response variable.</p>
</div>
<div class="section level3">
<h3 id="the-three-steps-of-the-algorithm">The three steps of the algorithm<a class="anchor" aria-label="anchor" href="#the-three-steps-of-the-algorithm"></a>
</h3>
<p>The first step involves fitting either a Poisson Gamma model with a
log link to the reference data. Here, it is possible to include an
arbitrary number of covariates by supplying a model formula. In order to
account for structural changes in the time series, e.g. an improved and
more sensitive diagnostic method or a new screening strategy at
hospitals, a rolling window with width <span class="math inline">\(k\)</span> is used to estimate the time-varying
model parameters. Also, it is assumed that the count is proportional to
the population size <span class="math inline">\(n\)</span>. Hence in
terms of the canonical link the model for the fixed effects is</p>
<p><span class="math display">\[\begin{equation}
  \log(\lambda_{it}) = x_{it}\beta + \log(n_{it}), \quad i=1,\dots,m,
\quad t=1,\dots,T
\end{equation}\]</span></p>
<p>Here <span class="math inline">\(x_{it}\)</span> and <span class="math inline">\(\beta\)</span> are <span class="math inline">\(p\)</span>-dimensional vectors of covariates and
fixed effects parameters respectively, where <span class="math inline">\(p\)</span> denotes the number of covariates or
fixed effects parameters, <span class="math inline">\(m\)</span> denotes
the number of groups, and <span class="math inline">\(T\)</span> denotes
the length of the period.</p>
<p>In the second step of the algorithm, as a new observation becomes
available, the algorithm infers the one-step ahead random effect <span class="math inline">\(u_{it_1}\)</span> for each group using the
obtained model estimates <span class="math inline">\(\theta_{t_0}\)</span>. Here, <span class="math inline">\(t_0\)</span> represents the current time point,
and <span class="math inline">\(t_1\)</span> represent the one-step
ahead time points. The threshold <span class="math inline">\(U_{t_0}\)</span> for detecting outbreak signals is
defined as a quantile of the distribution of random effects in the
second stage model. This threshold is calculated based on a Gamma
distribution using the plug-in estimate <span class="math inline">\(\hat{\phi}_{t_0}\)</span>.</p>
<p>In the final step, the inferred random effect <span class="math inline">\(\hat{u}_{it_1}\)</span> is compared to the upper
bound <span class="math inline">\(U_{t_0}\)</span>, and an alarm is
raised if <span class="math inline">\(\hat{u}_{it_1}&gt;U_{t_0}\)</span>. If an outbreak
is detected, the related observation <span class="math inline">\(y_{it_1}\)</span> is omitted from the parameter
estimation in the future. Thus, resulting in a smaller sample size for
the rolling window until that specific observation is discarded.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kasper Schou Telkamp, Lasse Engbo Christiansen, <a href="https://www.ssi.dk/" class="external-link"><img src="https://www.ssi.dk/assets/images/ssi-logo-optimeret.svg" alt="SSI" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
